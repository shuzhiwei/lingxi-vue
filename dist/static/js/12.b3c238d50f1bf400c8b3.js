webpackJsonp([12],{w5di:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("Xxa5"),n=a.n(r),i=a("exGp"),o=a.n(i),l=a("g5nd"),s=a("miE6"),c=a("mtWM"),d=a.n(c),m=(a("mw3O"),a("BoEg")),u={inject:["reload"],data:function(){return{title:"",content:"",imageAddr:"",image:"",imageAddrs:[],delImageAddrs:[],defaultImg:'this.src="'+a("DBQu")+'"',dialogImageUrl:"",dialogVisible:!1,fileList:[],form:{images1:[],radio:0}}},mounted:function(){var e=this,t=this.$route.params.id,a=Object(l.b)("lingxi-token"),r=this.$store.state.base_url+"/lingxis/view/"+t+"?token="+a;d.a.get(r).then(function(t){var r=t.data,n=r.code;if(console.log(n),402===n){var i=Object(l.b)("username");Object(s.a)(i,a),e.reload()}else if(200===n){e.title=r.data.title,e.content=r.data.content,e.form.radio=r.data.share_flag;var o=r.data.imageAddr,c=r.data.imageAddr.split("helloworld");if(-1!==o.indexOf("helloworld")){for(var d=0;d<c.length;d++)e.imageAddrs.push(c[d]);e.imageAddrs.pop()}else e.imageAddr=r.data.imageAddr}else console.log(n),e.$message.error("无acs权限！")})},methods:{deleteCurPhoto:function(e){this.delImageAddrs.push(this.imageAddrs[e]),this.imageAddrs.splice(e,1)},deletePrePhoto:function(e){this.form.images1.splice(e,1)},openFile:function(){document.getElementById("filename").click()},showRealPath:function(){for(var e=this,t=document.getElementById("filename").files,a=function(a){var r=t[a].name,n=new FileReader;n.readAsDataURL(t[a]),n.onload=function(){var t=n.result;e.form.images1.push({name:r,image:t})}},r=0;r<t.length;r++)a(r)},postCancel:function(){this.$router.push({path:"/main/home"})},postEntry:function(){var e=this;return o()(n.a.mark(function t(){var a,r,i,o,c,d,u,f,g,h,v,_,p,b,x;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(a=e.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),console.log("hello123"),r=Object(l.b)("lingxi-token"),i=e.$route.params.id,o=e.$store.state.base_url+"/lingxis/blog/edit/"+i,c=e.$store.state.base_url+"/lingxis/blog/editAddPhoto/"+i,d="",u=0;u<e.imageAddrs.length;u++)d=d+e.imageAddrs[u]+"helloworld";for(f="",g=0;g<e.delImageAddrs.length;g++)f=f+e.delImageAddrs[g]+"helloworld";return h={token:r,title:e.title,content:e.content,share_flag:e.form.radio,curImageAddrs:d,delImageAddrs:f},console.log("url: "+o),t.next=14,m.a.post(o,h);case 14:if(v=t.sent,console.log("aaaa"),402!==v.code){t.next=20;break}return Object(s.a)(e.username,r),e.postEntry(),t.abrupt("return");case 20:_="",p=0;case 22:if(!(p<e.form.images1.length)){t.next=35;break}if(!((_=_+e.form.images1[p].image+"helloworld").length>5242880)){t.next=32;break}return console.log(p),b={token:r,image:_},console.log(b),t.next=30,m.a.post(c,b);case 30:v=t.sent,_="";case 32:p++,t.next=22;break;case 35:if(!_){t.next=40;break}return x={token:r,image:_},console.log(x),t.next=40,m.a.post(c,x);case 40:a.close(),e.$router.push({path:"/main/detail/"+i}),e.reload();case 43:case"end":return t.stop()}},t,e)}))()}}},f={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{align:"center"}},[a("table",{attrs:{align:"center"}},[a("tr",[e._m(0),a("td",[a("el-input",{attrs:{placeholder:"请输入内容",clearable:""},model:{value:e.title,callback:function(t){e.title=t},expression:"title"}})],1)]),e._v(" "),a("tr",[e._m(1),a("td",[a("el-input",{attrs:{type:"textarea",autosize:{minRows:8,maxRows:20},placeholder:"请输入内容"},model:{value:e.content,callback:function(t){e.content=t},expression:"content"}})],1)]),e._v(" "),a("tr",[e._m(2),a("td",[e.imageAddr?a("div",[a("div",{staticClass:"img-box"},[a("img",{staticClass:"myimage",attrs:{src:e.imageAddr,alt:"logo",onerror:e.defaultImg}}),e._v(" "),a("div",{staticClass:"del-icon",on:{click:function(t){return e.deleteCurPhoto(e.index)}}})])]):a("div",e._l(e.imageAddrs,function(t,r){return a("span",{key:r},[a("div",{staticClass:"img-box"},[a("img",{staticClass:"myimage",attrs:{src:t,alt:"",onerror:e.defaultImg}}),e._v(" "),a("div",{staticClass:"del-icon",on:{click:function(t){return e.deleteCurPhoto(r)}}})])])}),0)])]),e._v(" "),a("tr",[e._m(3),e._v(" "),a("td",[a("el-radio",{staticStyle:{"margin-left":"10px"},attrs:{label:1},model:{value:e.form.radio,callback:function(t){e.$set(e.form,"radio",t)},expression:"form.radio"}},[e._v("公开")]),e._v(" "),a("el-radio",{attrs:{label:0},model:{value:e.form.radio,callback:function(t){e.$set(e.form,"radio",t)},expression:"form.radio"}},[e._v("不公开")])],1)]),e._v(" "),a("br"),e._v(" "),a("tr",[e._m(4),e._v(" "),a("td",[a("span",{attrs:{align:"left"}},[a("el-button",{attrs:{type:"primary",round:""},on:{click:function(t){return e.openFile()}}},[e._v("选择照片")]),e._v(" "),a("input",{staticStyle:{display:"none"},attrs:{type:"file",id:"filename",multiple:"multiple"},on:{change:e.showRealPath}})],1),e._v(" "),a("br"),e._v(" "),e._l(e.form.images1,function(t,r){return a("span",{key:r},[a("div",{staticClass:"img-box"},[a("img",{staticClass:"myimage",attrs:{src:t.image,alt:""}}),e._v(" "),a("div",{staticClass:"del-icon",on:{click:function(t){return e.deletePrePhoto(r)}}})])])})],2)]),e._v(" "),a("tr",[e._m(5),e._v(" "),a("td",[a("br"),e._v(" "),a("el-button",{attrs:{type:"info"},on:{click:e.postCancel}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.postEntry}},[e._v("提 交")])],1)])]),e._v(" "),a("br"),a("br")])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("th",[t("label",{attrs:{for:"title"}},[this._v("标题：")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("th",[t("label",{attrs:{for:"content"}},[this._v("内容：")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("th",[t("label",{attrs:{for:"content"}},[this._v("图片：")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("th",[t("label",{attrs:{for:"content"}},[this._v("分享：")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("th",[t("label",{attrs:{for:"addOther"}},[this._v("添加：")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("th",[t("label",{attrs:{for:"Post entry"}})])}]};var g=a("VU/8")(u,f,!1,function(e){a("x6AC")},null,null);t.default=g.exports},x6AC:function(e,t){}});