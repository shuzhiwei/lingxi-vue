webpackJsonp([4],{"hDa/":function(t,e){},mvHQ:function(t,e,n){t.exports={default:n("qkKv"),__esModule:!0}},qkKv:function(t,e,n){var i=n("FeBl"),s=i.JSON||(i.JSON={stringify:JSON.stringify});t.exports=function(t){return s.stringify.apply(s,arguments)}},"vi/S":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("mvHQ"),s=n.n(i),o=n("g5nd"),r={inject:["reload"],data:function(){return{token:Object(o.b)("lingxi-token"),username:"",ws:Object}},mounted:function(){var t=this,e=new WebSocket("wss://www.nnbkqnp.cn:7996/websocket");this.ws=e;var n=Object(o.b)("username");function i(t){var n=s()(t);e.send(n)}function r(t){var e=document.getElementById("msg_list"),n=document.createElement("p");n.innerHTML=t,e.appendChild(n),e.scrollTop=e.scrollHeight}this.username=n,console.log(n),console.log(e),e.onopen=function(){r("系统消息：建立连接成功")},e.onmessage=function(t){console.log(t.data);var e,s,o,l=JSON.parse(t.data);switch(l.type){case"system":e="系统消息: ";break;case"user":e=l.from+": ";break;case"handshake":return void i({type:"login",content:n});case"login":case"logout":return s=l.content,o=l.user_list,void function(t,e,n){var i=document.getElementById("user_list"),s=document.getElementById("user_num");for(;i.hasChildNodes();)i.removeChild(i.firstChild);for(var o in n){var l=document.createElement("p");l.innerHTML=n[o],i.appendChild(l)}s.innerHTML=n.length,i.scrollTop=i.scrollHeight,r("系统消息: "+t+" 已"+("login"==e?"上线":"下线"))}(s,l.type,o)}r(e+l.content)},e.onerror=function(){r("系统消息 : 出错了,请退出重试.")},this.$once("hook:beforeDestroy",function(){var e={type:"logout",content:t.username};t.sendMsg(e),t.ws.close()})},methods:{sendMsg:function(t){var e=s()(t);this.ws.send(e)},send:function(){console.log(this.username);var t=document.getElementById("msg_box"),e=t.value,n=new RegExp("\r\n","g"),i={content:(e=e.replace(n,"")).trim(),type:"send"};this.sendMsg(i),t.value=""},confirm:function(t){if(13!=t.keyCode)return!1;this.send()},leaveChat:function(){var t={type:"logout",content:this.username};this.sendMsg(t),this.ws.close(),this.$router.push({path:"/main/home"}),this.reload()}}},l={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticStyle:{width:"320px",height:"300px",margin:"30px auto","text-align":"center"}},[n("h1",[t._v("灵犀聊天室")]),t._v(" "),t._m(0),t._v(" "),n("br"),t._v(" "),n("div",{staticStyle:{width:"320px",height:"50px"}},[n("div",{staticStyle:{width:"200px",height:"50px",float:"left","text-align":"left"}},[n("textarea",{attrs:{id:"msg_box",rows:"2",cols:"25"},on:{keydown:function(e){return t.confirm(e)}}})]),t._v(" "),n("div",{staticStyle:{width:"60px",height:"50px",float:"left","text-align":"left"}},[n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.send}},[t._v("发送")])],1),t._v(" "),n("div",{staticStyle:{width:"60px",height:"50px",float:"left","text-align":"left"}},[n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.leaveChat}},[t._v("返回")])],1)])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticStyle:{width:"320px",border:"1px solid gray",height:"250px"}},[e("div",{staticStyle:{width:"90px",height:"250px",float:"left","text-align":"left"}},[e("p",[e("span",[this._v("当前在线:")]),e("span",{attrs:{id:"user_num"}},[this._v("0")])]),this._v(" "),e("div",{staticStyle:{overflow:"auto"},attrs:{id:"user_list"}})]),this._v(" "),e("div",{staticStyle:{width:"228px",border:"1px solid gray",height:"250px",overflow:"scroll",float:"left","text-align":"left"},attrs:{id:"msg_list"}})])}]};var a=n("VU/8")(r,l,!1,function(t){n("hDa/")},null,null);e.default=a.exports}});